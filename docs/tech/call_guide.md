# ì½œê°€ì´ë“œ ì‹œìŠ¤í…œ (Call Guide System)

> ì•„í‹°ìŠ¤íŠ¸ ê³¡ë³„ í˜¸ì‘ë²•(ì½œ&ë¦¬ìŠ¤í°ìŠ¤)ì„ ì»¤ë®¤ë‹ˆí‹°ê°€ í•¨ê»˜ ì‘ì„±/í¸ì§‘í•˜ëŠ” ì‹œìŠ¤í…œ

## ê°œìš”

ì½œê°€ì´ë“œëŠ” ê³µì—°ì—ì„œ ê´€ê°ì´ ì•„í‹°ìŠ¤íŠ¸ì™€ í•¨ê»˜ í˜¸ì‘í•˜ëŠ” ë°©ë²•ì„ ì •ë¦¬í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.
YouTube ì˜ìƒê³¼ ì‹œê°„ ë™ê¸°í™”í•˜ì—¬ ê°€ì‚¬ì™€ í˜¸ì‘ ì§€ì‹œë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â–¶ YouTube Player                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                         â”‚   â”‚
â”‚  â”‚          [ì˜ìƒ ì¬ìƒ ì˜ì—­]                 â”‚   â”‚
â”‚  â”‚                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1:23 / 3:45     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1:20  ğŸ¤ [ê°€ì‚¬] ë„ˆë¥¼ ë§Œë‚œ ì´ ê±°ë¦¬ì—ì„œ      â”‚   â”‚
â”‚  â”‚ 1:23  ğŸ“£ [ë–¼ì°½] í•¨ê»˜ ë¶ˆëŸ¬ìš”!              â”‚ â† í˜„ì¬ â”‚
â”‚  â”‚ 1:28  ğŸ‘‹ [ë™ì‘] ì† í”ë“¤ê¸°                 â”‚   â”‚
â”‚  â”‚ 1:35  ğŸ¤ [ê°€ì‚¬] ì˜ì›íˆ ê¸°ì–µí• ê²Œ           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ì½œ íƒ€ì… (Call Types)

| íƒ€ì… | ì•„ì´ì½˜ | ìƒ‰ìƒ | ì„¤ëª… | ì˜ˆì‹œ |
|------|--------|------|------|------|
| `lyrics` | ğŸ¤ | gray | ê°€ì‚¬ í‘œì‹œ | ì¼ë°˜ ê°€ì‚¬ |
| `singalong` | ğŸµ | blue | ë–¼ì°½ êµ¬ê°„ | ì½”ëŸ¬ìŠ¤, í›„ë ´ |
| `call` | ğŸ“£ | orange | ì¶”ì„ìƒˆ/ì½œ | "Hey!", "Yeah!" |
| `response` | ğŸ’¬ | purple | ë¦¬ìŠ¤í°ìŠ¤ | ì•„í‹°ìŠ¤íŠ¸ ì§ˆë¬¸ì— ëŒ€í•œ ì‘ë‹µ |
| `action` | ğŸ‘‹ | green | ë™ì‘ | ì†í”ë“¤ê¸°, ì í”„ |
| `jump` | ğŸ¦˜ | green | ì í”„ | ë–¼ì í”„ êµ¬ê°„ |
| `light` | ğŸ“± | yellow | ì¡°ëª… | í”Œë˜ì‹œ, ì‘ì›ë´‰ |
| `quiet` | ğŸ¤« | muted | ì¡°ìš©íˆ | ë°œë¼ë“œ, ë©˜íŠ¸ êµ¬ê°„ |
| `clap` | ğŸ‘ | pink | ë°•ìˆ˜ | ë¦¬ë“¬ì— ë§ì¶° ë°•ìˆ˜ |
| `wave` | ğŸŒŠ | cyan | íŒŒë„ | íŒŒë„íƒ€ê¸° |

## ë°ì´í„° êµ¬ì¡°

### Song (ê³¡ ì •ë³´)

```typescript
interface Song {
  id: string;                    // ê³ ìœ  ID
  title: string;                 // ê³¡ ì œëª©
  artistId: string;              // ì•„í‹°ìŠ¤íŠ¸ ID
  artistName: string;            // ì•„í‹°ìŠ¤íŠ¸ ì´ë¦„
  youtubeId: string;             // YouTube ì˜ìƒ ID
  duration: number;              // ì¬ìƒ ì‹œê°„ (ì´ˆ)
  thumbnailUrl?: string;         // ì¸ë„¤ì¼ URL
  releaseYear?: number;          // ë°œë§¤ ì—°ë„
  album?: string;                // ì•¨ë²”ëª…
}
```

### CallGuideEntry (ì½œê°€ì´ë“œ í•­ëª©)

```typescript
interface CallGuideEntry {
  id: string;                    // ê³ ìœ  ID
  startTime: number;             // ì‹œì‘ ì‹œê°„ (ì´ˆ, ì†Œìˆ˜ì  í—ˆìš©)
  endTime?: number;              // ì¢…ë£Œ ì‹œê°„ (ì„ íƒ)
  type: CallType;                // ì½œ íƒ€ì…
  text: string;                  // í‘œì‹œí•  í…ìŠ¤íŠ¸ (ê°€ì‚¬/ì§€ì‹œ)
  textRomanized?: string;        // ë¡œë§ˆì í‘œê¸°
  textOriginal?: string;         // ì›ë¬¸ (ì¼ë³¸ì–´/ì˜ì–´ ë“±)
  instruction?: string;          // ì¶”ê°€ ì„¤ëª…
  intensity?: 1 | 2 | 3;         // ê°•ë„ (1: ì•½, 2: ë³´í†µ, 3: ê°•)
}
```

### CallGuide (ì½œê°€ì´ë“œ ì „ì²´)

```typescript
interface CallGuide {
  id: string;                    // ê³ ìœ  ID
  songId: string;                // ê³¡ ID
  entries: CallGuideEntry[];     // í•­ëª© ëª©ë¡
  createdBy: string;             // ìµœì´ˆ ì‘ì„±ì ID
  createdAt: Date;               // ìƒì„± ì‹œê°
  updatedAt: Date;               // ìˆ˜ì • ì‹œê°
  version: number;               // ë²„ì „ ë²ˆí˜¸
  contributors: string[];        // ê¸°ì—¬ì ëª©ë¡
  status: 'draft' | 'published' | 'verified';
  verifiedBy?: string;           // ê²€ì¦ì ID
  helpfulCount: number;          // ë„ì›€ë¨ ìˆ˜
}
```

### CallGuideVersion (ë²„ì „ íˆìŠ¤í† ë¦¬)

```typescript
interface CallGuideVersion {
  id: string;
  callGuideId: string;
  version: number;
  entries: CallGuideEntry[];
  editedBy: string;
  editedAt: Date;
  changeDescription?: string;    // ë³€ê²½ ì„¤ëª…
}
```

## YouTube ì—°ë™

### YouTube IFrame API ì‚¬ìš©

```typescript
// YouTube Player ì´ˆê¸°í™”
const player = new YT.Player('player', {
  height: '360',
  width: '640',
  videoId: song.youtubeId,
  playerVars: {
    autoplay: 0,
    controls: 1,
    rel: 0,
  },
  events: {
    onReady: onPlayerReady,
    onStateChange: onPlayerStateChange,
  }
});

// í˜„ì¬ ì¬ìƒ ì‹œê°„ ì¶”ì  (100ms ê°„ê²©)
const syncInterval = setInterval(() => {
  const currentTime = player.getCurrentTime();
  updateActiveEntry(currentTime);
}, 100);
```

### ì‹œê°„ ë™ê¸°í™” ë¡œì§

```typescript
function updateActiveEntry(currentTime: number) {
  const activeEntry = entries.find(entry =>
    currentTime >= entry.startTime &&
    (!entry.endTime || currentTime < entry.endTime)
  );

  if (activeEntry !== previousActive) {
    highlightEntry(activeEntry);
    scrollToEntry(activeEntry);
  }
}
```

## ì—ë””í„° UX

### íƒ€ì„ìŠ¤íƒ¬í”„ ì…ë ¥ ë°©ì‹

1. **ì‹¤ì‹œê°„ ë§ˆí‚¹**: ì˜ìƒ ì¬ìƒ ì¤‘ í‚¤ë³´ë“œë¡œ ë§ˆí‚¹
   - `Space`: í˜„ì¬ ì‹œê°„ì— ë¹ˆ í•­ëª© ì¶”ê°€
   - `1-9`: ì½œ íƒ€ì… ë‹¨ì¶•í‚¤
   - `Enter`: í…ìŠ¤íŠ¸ ì…ë ¥ ëª¨ë“œ

2. **ìˆ˜ë™ ì…ë ¥**: ì‹œê°„ ì§ì ‘ ì…ë ¥
   - `MM:SS.ms` í˜•ì‹ (ì˜ˆ: `01:23.5`)

3. **ë“œë˜ê·¸ ì¡°ì •**: íƒ€ì„ë¼ì¸ì—ì„œ ë“œë˜ê·¸ë¡œ ë¯¸ì„¸ ì¡°ì •

### í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤

| í‚¤ | ê¸°ëŠ¥ |
|----|------|
| `Space` | ì¬ìƒ/ì¼ì‹œì •ì§€ |
| `â†` / `â†’` | 5ì´ˆ ì´ë™ |
| `Shift + â†/â†’` | 1ì´ˆ ì´ë™ |
| `M` | í˜„ì¬ ì‹œê°„ì— ë§ˆí‚¹ |
| `1` | ê°€ì‚¬ (lyrics) |
| `2` | ë–¼ì°½ (singalong) |
| `3` | ì½œ (call) |
| `4` | ë™ì‘ (action) |
| `5` | ì¡°ëª… (light) |
| `Delete` | í•­ëª© ì‚­ì œ |
| `Ctrl+S` | ì €ì¥ |

## ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
src/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ call-guide.ts           # íƒ€ì… ì •ì˜
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ call-guide-context.tsx  # Context (CRUD, ë™ê¸°í™”)
â”œâ”€â”€ components/
â”‚   â””â”€â”€ call-guide/
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ CallGuideViewer.tsx      # ë·°ì–´ (ì¬ìƒ + ê°€ì´ë“œ í‘œì‹œ)
â”‚       â”œâ”€â”€ CallGuideEditor.tsx      # ì—ë””í„° (ì‘ì„±/ìˆ˜ì •)
â”‚       â”œâ”€â”€ CallGuideTimeline.tsx    # íƒ€ì„ë¼ì¸ UI
â”‚       â”œâ”€â”€ CallGuideEntry.tsx       # ê°œë³„ í•­ëª©
â”‚       â”œâ”€â”€ CallTypePalette.tsx      # ì½œ íƒ€ì… ì„ íƒ
â”‚       â”œâ”€â”€ YouTubePlayer.tsx        # YouTube í”Œë ˆì´ì–´ ë˜í¼
â”‚       â””â”€â”€ MiniCallGuide.tsx        # ë¯¸ë‹ˆ ë·°ì–´ (ê³µì—° ì¤‘)
â””â”€â”€ app/
    â””â”€â”€ call-guide/
        â”œâ”€â”€ page.tsx                 # ì½œê°€ì´ë“œ ëª©ë¡
        â”œâ”€â”€ [songId]/
        â”‚   â””â”€â”€ page.tsx             # ì½œê°€ì´ë“œ ë·°ì–´
        â””â”€â”€ edit/
            â””â”€â”€ [songId]/
                â””â”€â”€ page.tsx         # ì½œê°€ì´ë“œ ì—ë””í„°
```

## í˜ì´ì§€ ë¼ìš°íŒ…

| ê²½ë¡œ | ì„¤ëª… |
|------|------|
| `/call-guide` | ì½œê°€ì´ë“œ ëª©ë¡ (ì•„í‹°ìŠ¤íŠ¸ë³„/ìµœê·¼/ì¸ê¸°) |
| `/call-guide/[songId]` | ì½œê°€ì´ë“œ ë·°ì–´ |
| `/call-guide/edit/[songId]` | ì½œê°€ì´ë“œ ì—ë””í„° |
| `/call-guide/new` | ìƒˆ ì½œê°€ì´ë“œ ìƒì„± (ê³¡ ê²€ìƒ‰) |

## ì—°ë™ í¬ì¸íŠ¸

### 1. íƒ€ì„í…Œì´ë¸” ì—°ë™

```
íƒ€ì„í…Œì´ë¸” ìŠ¬ë¡¯ â†’ ì•„í‹°ìŠ¤íŠ¸ í´ë¦­ â†’ í˜¸ì‘ë²• íƒ­ â†’ ê³¡ ëª©ë¡ â†’ ì½œê°€ì´ë“œ ë·°ì–´
```

### 2. ì•„í‹°ìŠ¤íŠ¸ í˜ì´ì§€ ì—°ë™

```
ì•„í‹°ìŠ¤íŠ¸ í˜ì´ì§€ â†’ í˜¸ì‘ë²• íƒ­ â†’ ì¸ê¸°ìˆœ/ìµœê·¼ìˆœ ì½œê°€ì´ë“œ ëª©ë¡
```

### 3. LIVE ëª¨ë“œ ì—°ë™

```
í˜„ì¬ ê³µì—° ì¤‘ì¸ ìŠ¬ë¡¯ â†’ ì˜ˆìƒ ì…‹ë¦¬ìŠ¤íŠ¸ â†’ í˜„ì¬ ê³¡ ì¶”ì • â†’ ë¯¸ë‹ˆ ì½œê°€ì´ë“œ í‘œì‹œ
```

### 4. ì•Œë¦¼ ì—°ë™

```
ìŠ¬ë¡¯ ì‹œì‘ 10ë¶„ ì „ â†’ "í˜¸ì‘ë²• í™•ì¸í•˜ê¸°" í‘¸ì‹œ ì•Œë¦¼ â†’ ì½œê°€ì´ë“œ ëª©ë¡ìœ¼ë¡œ ì´ë™
```

## ì €ì¥ì†Œ ì „í™˜ (LocalStorage â†’ Supabase)

### Phase 1: LocalStorage

```typescript
const STORAGE_KEY = 'fesmate_call_guides';

function saveCallGuide(callGuide: CallGuide) {
  const existing = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  const updated = [...existing.filter(g => g.id !== callGuide.id), callGuide];
  localStorage.setItem(STORAGE_KEY, JSON.stringify(updated));
}
```

### Phase 2: Supabase

```sql
-- ì½œê°€ì´ë“œ í…Œì´ë¸”
CREATE TABLE call_guides (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  song_id UUID REFERENCES songs(id),
  entries JSONB NOT NULL,
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  version INTEGER DEFAULT 1,
  status TEXT DEFAULT 'draft',
  helpful_count INTEGER DEFAULT 0
);

-- ë²„ì „ íˆìŠ¤í† ë¦¬
CREATE TABLE call_guide_versions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  call_guide_id UUID REFERENCES call_guides(id),
  version INTEGER NOT NULL,
  entries JSONB NOT NULL,
  edited_by UUID REFERENCES users(id),
  edited_at TIMESTAMPTZ DEFAULT now(),
  change_description TEXT
);

-- RLS ì •ì±…
ALTER TABLE call_guides ENABLE ROW LEVEL SECURITY;

-- ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Public read" ON call_guides FOR SELECT USING (true);

-- ë¡œê·¸ì¸ ì‚¬ìš©ìë§Œ ì‘ì„± ê°€ëŠ¥
CREATE POLICY "Auth insert" ON call_guides FOR INSERT
  WITH CHECK (auth.uid() = created_by);

-- ì‘ì„±ì ë˜ëŠ” ê¸°ì—¬ìë§Œ ìˆ˜ì • ê°€ëŠ¥
CREATE POLICY "Contributors update" ON call_guides FOR UPDATE
  USING (auth.uid() = created_by OR auth.uid() = ANY(contributors));
```

## ì‹ ë¢°ë„ ì‹œìŠ¤í…œ

### ì‹ ë¢°ë„ ë“±ê¸‰

| ë“±ê¸‰ | ì¡°ê±´ | í‘œì‹œ |
|------|------|------|
| ê²€ì¦ë¨ (Verified) | ê´€ë¦¬ì ê²€ì¦ | âœ… ê³µì‹ ê°€ì´ë“œ |
| ì‹ ë¢° (Trusted) | ë„ì›€ë¨ 50+ ë˜ëŠ” ê¸°ì—¬ì 5+ | â­ ì»¤ë®¤ë‹ˆí‹° ì¶”ì²œ |
| ì¼ë°˜ (Normal) | ê¸°ë³¸ ìƒíƒœ | (í‘œì‹œ ì—†ìŒ) |
| ì´ˆì•ˆ (Draft) | ë¯¸ì™„ì„±/ë¹„ê³µê°œ | ğŸ“ ì‘ì„± ì¤‘ |

### ê¸°ì—¬ë„ ì ìˆ˜

- ì½œê°€ì´ë“œ ìµœì´ˆ ì‘ì„±: 20ì 
- ì½œê°€ì´ë“œ ìˆ˜ì • ê¸°ì—¬: 5ì 
- ë„ì›€ë¨ ë°›ìŒ: 2ì  (per 1ê°œ)
- ê²€ì¦ë¨ ìŠ¹ì¸: 30ì 

## í–¥í›„ í™•ì¥

### P2 ê¸°ëŠ¥

1. **ìŒì„± ê°€ì´ë“œ**: TTSë¡œ ì½œ íƒ€ì´ë°ì— ìŒì„± ì•ˆë‚´
2. **ì§„ë™ í”¼ë“œë°±**: ëª¨ë°”ì¼ì—ì„œ ì½œ íƒ€ì´ë°ì— ì§„ë™
3. **AR ì˜¤ë²„ë ˆì´**: ì¹´ë©”ë¼ë¡œ ë¬´ëŒ€ ë³´ë©° ê°€ì´ë“œ í‘œì‹œ
4. **ì…‹ë¦¬ìŠ¤íŠ¸ ì—°ë™**: ì‹¤ì‹œê°„ ì…‹ë¦¬ìŠ¤íŠ¸ì™€ ì½œê°€ì´ë“œ ìë™ ì—°ê²°

### ë°ì´í„° ìˆ˜ì§‘

1. **Setlist.fm API**: ê³¼ê±° ì…‹ë¦¬ìŠ¤íŠ¸ ë°ì´í„°
2. **YouTube ìë§‰**: ìë™ ê°€ì‚¬ ì¶”ì¶œ (ë² ì´ìŠ¤ë¼ì¸)
3. **ì»¤ë®¤ë‹ˆí‹° ì œë³´**: ì‹¤ì‹œê°„ ì…‹ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
