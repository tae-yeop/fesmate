# 2026-01 개발 로그

## 잔여 작업 현황

| 카테고리 | 대략적 개수 | 주요 항목 | 상태 |
|----------|------------|-----------|------|
| Supabase 연동 | ~20개 | DB 마이그레이션, 쿼리 전환, Realtime | 진행 중 |
| 크루 오버레이 P2-P3 | 4개 | 히트맵, 소그룹, 통계, 추천 | 미착수 |
| 사용자 이벤트 등록 | ~12개 | 행사 등록, 타임테이블 편집, 셋리스트 | 미착수 |
| 크롤링 파이프라인 | ~5개 | Fetcher, Extractor, Normalizer | 미착수 |
| Admin 도구 | ~7개 | 행사 관리, 신고 처리, 감사로그 | 미착수 |
| 푸시/알림 | ~5개 | 푸시 알림, Quiet Hours, 중복 묶음 | ✅ 완료 |
| 티켓북 확장 | ~8개 | 공유 기능, 연간 리포트 | ✅ 완료 |
| 품질/보안 | ~10개 | 스팸 방지, 신뢰도, 프라이버시 | ✅ 완료 |
| 기타 | ~24개 | 콜가이드 LIVE, 카카오 OAuth 등 | ✅ 완료 (21/24) |

---

## 2026-01-04: 데이터 모드 분리 (Mock/Supabase)

### 문제
- Mock 데이터(문자열 ID)와 Supabase(UUID)가 혼용되어 데이터 불일치 발생
- 글 작성 후 새로고침 시 사라지는 문제
- mockUserId, dataMode가 새로고침 시 리셋되는 문제

### 근본 원인
1. DevContext의 상태가 localStorage에 저장되지 않음
2. PostContext가 DevContext hydration 전에 데이터를 로드함 (초기값 사용)
3. 새로고침 시 mockUserId=null, dataMode="mock"으로 리셋

### 해결
- DevContext에 `isHydrated` 상태 추가 (localStorage 로드 완료 표시)
- DevContext에서 `mockUserId`, `dataMode`를 localStorage에 저장/복원
- PostContext에서 `isHydrated`가 true일 때만 데이터 로드 (hydration 대기)
- 상세 디버깅 로그 추가

### 테스트 방법

1. 개발 서버 재시작 (`npm run dev`)
2. Dev 패널 열기 (🛠️ 버튼)
3. "세션" 섹션에서 user1 선택
4. "데이터 소스" 섹션에서 Mock 선택
5. `/community`에서 글 작성
6. 콘솔 로그 확인:
   - `[DevContext] Saved to localStorage: {mockUserId: "user1", dataMode: "mock"}`
   - `[PostContext] Saving to localStorage: 1 user posts`
7. **새로고침 (F5)**
8. 콘솔 로그 확인:
   - `[DevContext] Load useEffect triggered`
   - `[DevContext] localStorage.getItem result: {...}`
   - `[DevContext] Parsed settings: {mockUserId: "user1", dataMode: "mock"}`
   - `[PostContext] DevContext hydrated, loading posts...`
   - `[PostContext] Loading from localStorage: 1 user posts`
9. user1 상태 유지 + 작성한 글 표시 확인

### 수정된 파일

| 파일 | 변경 내용 |
|------|----------|
| `src/lib/dev-context.tsx` | `dataMode`, `isHydrated` 추가, localStorage 저장/복원, 디버깅 로그 |
| `src/components/dev/DevPanel.tsx` | 데이터 모드 토글 UI |
| `src/lib/post-context.tsx` | `isHydrated` 체크 추가, hydration 대기 로직 |

### localStorage 키
- Dev 설정: `fesmate:v1:device:dev-settings`
- 사용자 글: `fesmate:v1:shared:user-posts`

---

## 2026-01-03: 기타 기능 ~21개 완료

> 상세 테스트 가이드: [2026-01-03-기타기능-테스트가이드.md](./2026-01-03-기타기능-테스트가이드.md)

### 완료된 기능 목록

#### P0 - 즉시 구현 (5개)
1. ✅ 자기 글 도움됨 차단
2. ✅ canViewContent 완성 (friends/crew 레벨)
3. ✅ 리더보드 신고 시 점수 차감
4. ✅ 신고 누적 시 글 자동 숨김
5. ✅ 숨김 글 UI (검토 중 표시 + 보기/차단 CTA)

#### P1 - 알림 시스템 고도화 (4개)
6. ✅ Quiet Hours (22:00-08:00)
7. ✅ 중복 묶음 (dedupe_key)
8. ✅ 콜가이드 LIVE 연동 (HubTab)
9. ✅ 슬롯 시작 10분 전 알림

#### P2 - 푸시 알림 PWA (4개)
10. ✅ PWA Service Worker 설정
11. ✅ Web Push API 통합
12. ✅ 알림 권한 요청 UI
13. ✅ 콜가이드 푸시 알림

#### P2 - 콜가이드 고도화 (3개)
14. ✅ 버전 히스토리 UI
15. ✅ 수정 제안 (Suggest Edit)
16. ✅ 신고/롤백 기능

#### P2 - 리더보드 고도화 (3개)
17. ✅ 윌슨 스코어 적용
18. ✅ 최근성 가중치 (decay_factor)
19. ✅ 단기 대량 활동 감지 (어뷰징 방지)

#### P3 - 기타 (2개)
20. ✅ 슬롯 리뷰/영상 연결
21. ✅ FOMO 루프 (친구 다녀온 행사 하이라이트)

#### 보류
- ⏸️ 카카오 OAuth (사업자 인증 필요)
- ⏸️ 네이버 OAuth (사업자 인증 필요)
- ⏸️ 카카오톡 공유 (사업자 인증 필요)

### 신규 파일

| 파일 | 설명 |
|------|------|
| `src/components/call-guide/CallGuideHistory.tsx` | 버전 히스토리 + Diff UI |
| `src/components/call-guide/CallGuideSuggestion.tsx` | 수정 제안 폼/카드 |
| `src/components/call-guide/CallGuideReport.tsx` | 신고/롤백 모달 |
| `src/components/timetable/SlotContentSection.tsx` | 슬롯 리뷰/영상 연결 UI |
| `src/components/social/FriendsHighlightCarousel.tsx` | FOMO 루프 캐러셀 |
| `src/lib/slot-content-context.tsx` | 슬롯 콘텐츠 Context |

### 수정된 주요 파일

| 파일 | 변경 내용 |
|------|----------|
| `src/lib/helpful-context.tsx` | 자기 글 도움됨 차단 |
| `src/lib/user-profile-context.tsx` | canViewContent friends/crew 완성 |
| `src/lib/leaderboard-context.tsx` | 윌슨 스코어, decay_factor, 신고 차감 |
| `src/lib/post-context.tsx` | 신고 3회 시 자동 숨김 |
| `src/lib/notification-context.tsx` | Quiet Hours, dedupe_key |
| `src/lib/call-guide-context.tsx` | 롤백, 신고 기능 |
| `src/lib/trust-context.tsx` | 어뷰징 감지 |
| `src/types/event.ts` | SlotContent, SlotReviewType |
| `src/types/report.ts` | call_guide, call_guide_entry 타입 |
| `src/lib/storage/keys.ts` | SLOT_CONTENTS, CALLGUIDE_REPORTS 도메인 |

---

## 이전 기록

### 티켓 공유
- `/myfes` → 티켓북 탭 → 티켓 클릭 → 공유 버튼 클릭
- 다운로드, URL 복사, 카카오톡, 인스타 스토리 옵션

### 연간 리포트 (TODO: ReportGenerator를 UI에 연결 필요)
- 6가지 카드 타입: 총 관람, 장르, 아티스트, 월별, 동행자, 공연장
- Spotify Wrapped 스타일 디자인

### 공유 갤러리 (TODO: DB 마이그레이션 적용 후)
- `/share/tickets/[shareId]` - 공개 URL 갤러리
- OG 메타 태그로 SNS 미리보기 지원

---

### 티켓북 전체 공유 테스트
1. http://localhost:3000/myfes 접속
2. "티켓북" 탭 선택
3. "전체 공유" 버튼 클릭
4. 캐러셀로 티켓 미리보기
5. "공유 갤러리 만들기" 버튼으로 갤러리 생성

### 갤러리 편집
1. 갤러리 생성 후 "사진/SNS 추가하기" 클릭
2. `/myfes/gallery?id={galleryId}` 페이지에서:
   - 티켓 추가 (티켓북에서 선택)
   - 사진 추가 (파일 업로드)
   - SNS 추가 (Instagram/Twitter URL 붙여넣기)
   - 공개/비공개 설정
   - 공유 URL 생성 및 복사

### 공유 갤러리 보기
- http://localhost:3000/share/gallery/test-123 (Mock 데이터)
- 티켓, 사진, SNS 포스트가 타임라인으로 표시
