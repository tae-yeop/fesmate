# FesMate 개발 로그

> 이 문서는 FesMate 앱의 전체 개발 과정과 향후 계획을 기록합니다.
> Git 히스토리와 TODO.md를 기반으로 작성되었습니다.

---

## 목차

1. [프로젝트 개요](#프로젝트-개요)
2. [개발 타임라인](#개발-타임라인)
3. [기술 스택 및 코드 규모](#기술-스택-및-코드-규모)
4. [완료된 기능](#완료된-기능)
5. [Supabase 연동 현황](#supabase-연동-현황)
6. [향후 계획](#향후-계획)
7. [미구현 기능 목록](#미구현-기능-목록)
8. [개발 팁](#개발-팁)
9. [참고 문서](#참고-문서)

---

## 프로젝트 개요

**FesMate**는 공연/전시/페스티벌 정보를 한 곳에 모아 제공하는 "행사 허브" 앱입니다.

### 핵심 기능
- **행사 탐색**: 카드/리스트/캘린더 뷰 + 필터/정렬
- **LIVE/RECAP 모드**: 진행 중 실시간 정보 vs 종료 후 회고
- **커뮤니티**: 동행/택시/밥/숙소/양도/질문/팁/팬이벤트/뒷풀이
- **FieldNote/콜가이드**: 아티스트별 응원법 가이드 (뷰어/에디터)
- **티켓북**: 티켓 컬렉션 (호모그래피 변환, 템플릿)
- **MyFes**: 개인 행사 관리 + 공연로그 + 배지

---

## 개발 타임라인

> Git 히스토리 기반 (총 81개 커밋, 2025-11-29 ~ 2025-12-31)

### Week 1: 프로젝트 셋업 (2025-11-29)

| 커밋 | 내용 |
|------|------|
| `9c045b7` | first commit |
| `ff4f1d9` | Next.js 프로젝트 셋업, 디자인 시스템, 레이아웃 |

### Week 2: 핵심 UI 구현 (2025-12-17 ~ 2025-12-18)

| 커밋 | 내용 |
|------|------|
| `782c2ff` | Phase 1-6 UI (탐색, 행사 상세, 커뮤니티, MyFes) |
| `b159891` | 인증, 알림, 안전 시스템 (Phase 7, 8, 10) |
| `d50bc35` | 코드 구조 개선, 기술 부채 해소 |
| `54c2a0b` | 장소 필드 & 지도 딥링크 (PRD 6.4.1) |

### Week 3: Context 시스템 & 소셜 기능 (2025-12-20 ~ 2025-12-21)

| 커밋 | 내용 |
|------|------|
| `4c38246` | 디렉토리별 CLAUDE.md 가이드 |
| `d1fe650` | 소셜/커뮤니티 기능 타입 정의 |
| `0acdb25` | React Context 및 상태 관리 시스템 (19개 Context) |
| `74edd0c` | 테스트 자동화 (Vitest + Playwright) |
| `d6a0c8c` | 친구 타임테이블 오버레이 |
| `85d5aed` | "같이 볼까요" 동행 제안 |
| `3679772` | 배지 시스템 및 토스트 알림 (23개 배지) |
| `ca8c8f3` | 프로필 편집 페이지 |
| `dc31e69` | 알림 컨텍스트 및 페이지 개선 |
| `dd67033` | 크루 캘린더 컴포넌트 |
| `ff4598e` | 참여 시스템 개선 |
| `574d590` | 이미지 업로드 (Storage Adapter 패턴) |

### Week 3: FieldNote & 콜가이드 (2025-12-21)

| 커밋 | 내용 |
|------|------|
| `060cb39` | 콜가이드 시스템 기획 문서 (PRD 6.17) |
| `780e34c` | 콜가이드 타입 및 Context |
| `09ce3d5` | 콜가이드 UI 컴포넌트 (뷰어/에디터) |
| `4a24777` | FieldNote 페이지 라우트 |
| `6f14fbf` | 네비게이션에 FieldNote 탭 추가 (5탭 체계) |
| `6c46586` | Dev 패널 시나리오 G 추가 (펜타포트) |
| `10c1367` | PostComposer 개선 - 카테고리 선택 및 행사 검색 모달 |
| `8bc9cdb` | 글 타입 구조 개선 - 팬이벤트/뒷풀이 추가 |

### Week 4: 탐색 고도화 & 티켓북 (2025-12-23)

| 커밋 | 내용 |
|------|------|
| `cc10150` | 타임테이블 구조 개선 (Linear/Grid 뷰 자동 선택) |
| `229b007` | 비로그인 시 로그인 유도 모달 |
| `f3fd129` | 탐색 페이지 지난 행사 필터 및 RECAP 지원 |
| `7d43b13` | 캘린더뷰 찜 우선순위 및 대표 카드 표시 |
| `793fa27` | 양도글 티켓 사진 필수화 (PRD 6.19) |
| `8d10948` | 티켓북 기본 시스템 |
| `fba7145` | 티켓 에디터 - 호모그래피 변환 및 템플릿 |
| `31b43de` | 티켓북 뷰 선택 시스템 (가로/세로) |
| `68a8540` | MyFes 페이지에 티켓북 통합 |
| `d77db9d` | Supabase 마이그레이션 계획 추가 |

### Week 4: Supabase 연동 (2025-12-24 ~ 2025-12-31)

| 커밋 | 내용 |
|------|------|
| `11c8d16` | 티켓 편집 시 이미지 dimension 버그 수정 |
| `c6abdb9` | **Supabase 연동 및 콜가이드 개선** |

**`c6abdb9` 상세 내용:**
- CallGuideContext Supabase 연동 (도움됨 버튼)
- 개별 엔트리 도움됨 버튼 추가
- 편집 페이지 로그인 체크 수정 (Google OAuth 지원)
- `call_guide_entry_reactions` 테이블 마이그레이션 추가

---

## 기술 스택 및 코드 규모

### 기술 스택

| 영역 | 기술 |
|------|------|
| Framework | Next.js 16 (App Router) |
| Language | TypeScript 5 |
| UI | React 19, Tailwind CSS 4 |
| Icons | Lucide React |
| Backend | Supabase (PostgreSQL + Auth + Storage) |
| State | React Context + localStorage (→ Supabase 전환 중) |

### 코드 규모

| 항목 | 개수 |
|------|------|
| Git 커밋 | 81개 |
| Context 파일 | 19개 |
| 앱 라우트 | 15개 |
| 컴포넌트 폴더 | 19개 |
| 타입 파일 | 19개 |
| DB 마이그레이션 | 6개 + 1개 패치 |

---

## 완료된 기능

> 프론트엔드 UI 99% 완료 (Mock 데이터 기반)

### 핵심 기능
- [x] 5탭 네비게이션 (홈/탐색/노트/커뮤니티/MyFes)
- [x] 행사 탐색 3뷰 (카드/리스트/캘린더) + 필터/정렬
- [x] 행사 상세 페이지 (개요/허브/타임테이블/아티스트 탭)
- [x] LIVE/RECAP 모드 자동 전환
- [x] 커뮤니티 9개 카테고리 + 자동 만료
- [x] 글 작성 템플릿 (14개 타입)

### 소셜 기능
- [x] 찜/다녀옴 상태 관리
- [x] 도움됨 버튼
- [x] 댓글 시스템
- [x] 크루 (생성/가입/프로필/캘린더)
- [x] 팔로우/친구
- [x] 참여 신청 (동행/택시/밥/숙소)
- [x] 동행 제안 ("같이 볼까요")
- [x] 배지 시스템 (23개)
- [x] 리더보드

### 콘텐츠 기능
- [x] FieldNote/콜가이드 (뷰어/에디터)
- [x] 타임테이블 (Linear/Grid 뷰)
- [x] 나만의 타임테이블 + 친구 오버레이
- [x] 티켓북 (호모그래피 변환, 템플릿)
- [x] 이미지 업로드 (Storage Adapter)

### 인증/보안
- [x] Google OAuth
- [x] Dev 모드 (시나리오/시간/세션 시뮬레이터)
- [x] 차단/신고 시스템
- [x] 비로그인 시 로그인 유도

### Context 시스템 (19개) — ✅ 전체 연동 완료
| Context | 설명 | 저장소 | Supabase 연동 |
|---------|------|--------|--------------|
| AuthContext | Supabase 인증 | Supabase | ✅ 완료 |
| WishlistContext | 찜/다녀옴 | localStorage / Supabase | ✅ 완료 |
| HelpfulContext | 도움됨 | localStorage / Supabase | ✅ 완료 |
| CommentContext | 댓글 | localStorage / Supabase | ✅ 완료 |
| CrewContext | 크루 | localStorage / Supabase | ✅ 완료 |
| FollowContext | 팔로우 | localStorage / Supabase | ✅ 완료 |
| BlockContext | 차단 | localStorage / Supabase | ✅ 완료 |
| JoinContext | 참여 신청 | localStorage / Supabase | ✅ 완료 |
| CompanionContext | 동행 제안 | localStorage / Supabase | ✅ 완료 |
| ParticipationContext | 글 참여 | localStorage / Supabase | ✅ 완료 |
| NotificationContext | 알림 | localStorage / Supabase | ✅ 완료 |
| CallGuideContext | 콜가이드 | localStorage / Supabase | ✅ 완료 |
| TicketBookContext | 티켓북 | localStorage / Supabase | ✅ 완료 |
| PostContext | 게시글 | localStorage / Supabase | ✅ 완료 |
| UserProfileContext | 사용자 프로필 | localStorage / Supabase | ✅ 완료 |
| BadgeContext | 뱃지 | localStorage / Supabase | ✅ 완료 |
| MyTimetableContext | 내 타임테이블 | localStorage / Supabase | ✅ 완료 |
| LeaderboardContext | 리더보드 | localStorage / Supabase | ✅ 완료 |
| DevContext | 개발 모드 | 메모리 | N/A |

> **Note**: "localStorage / Supabase" 표시는 로그인 시 Supabase, 비로그인 시 localStorage 사용을 의미합니다.

---

## Supabase 연동 현황

### 연동 완료 (14개 Context)
| Context | 테이블 | 쿼리 파일 |
|---------|-------|----------|
| AuthContext | auth.users | - |
| WishlistContext | user_events | `user-events.ts` |
| HelpfulContext | post_reactions | `reactions.ts` |
| CommentContext | comments | `comments.ts` |
| CrewContext | crews, crew_members | `crews.ts` |
| FollowContext | follows | `follows.ts` |
| BlockContext | blocks | `blocks.ts` |
| ParticipationContext | participation_requests | `participation.ts` |
| NotificationContext | notifications | `notifications.ts` |
| CallGuideContext | call_guides, call_guide_entries | `call-guides.ts` |
| PostContext | posts | `posts.ts` |
| UserProfileContext | users | `users.ts` |
| MyTimetableContext | user_slot_marks, custom_events | `my-timetable.ts` |

> 로그인 시 Supabase, 비로그인/Dev모드 시 localStorage 폴백 패턴 적용

### 추가 연동 완료 (5개 Context) - 2025-12-31
| Context | 테이블 | 쿼리 파일 |
|---------|-------|----------|
| JoinContext | participation_requests | `participation.ts` (재사용) |
| CompanionContext | companion_requests | `companions.ts` |
| TicketBookContext | tickets | `tickets.ts` |
| BadgeContext | user_badges | `badges.ts` |
| LeaderboardContext | users/posts/comments (집계) | `leaderboard.ts` |

### DB 스키마 (준비됨)
- `supabase/migrations/` (6개 파일)
  - `00001_core_tables.sql` - venues, artists, events, stages, slots
  - `00002_user_tables.sql` - users, user_events, follows, blocks
  - `00003_content_tables.sql` - posts, comments, notifications, reports
  - `00004_social_tables.sql` - crews, crew_members, participation
  - `00005_guide_tables.sql` - songs, call_guides, call_guide_entries
  - `00006_rls_policies.sql` - Row Level Security 정책
- 패치: `supabase/patches/add_entry_reactions.sql`
- TypeScript 타입: `src/types/database.ts`
- 쿼리 함수: `src/lib/supabase/queries/`

---

## 향후 계획

### Phase 1: DB 마이그레이션 실행 ✅ 완료
- **테이블 생성 완료**: 35개 테이블 (RLS 정책 적용됨)
- **Seed 데이터 삽입 완료**:
  - artists: 33개
  - events: 14개
  - venues: 14개
  - stages: 5개
  - operational_slots: 7개
  - crews: 4개
  - posts: 3개
- **환경변수 설정 완료**: `.env.local`

### Phase 2: 나머지 Context Supabase 연동 — ✅ 완료
- ~~MyTimetableContext → user_slot_marks, custom_events (P1)~~ ✅ 완료
- ~~JoinContext → participation_requests 테이블 재사용~~ ✅ 완료
- ~~CompanionContext → companion_requests 테이블 추가~~ ✅ 완료
- ~~TicketBookContext → tickets 테이블 추가~~ ✅ 완료
- ~~BadgeContext → user_badges 테이블~~ ✅ 완료
- ~~LeaderboardContext → users/posts/comments 집계 쿼리~~ ✅ 완료

### Phase 3: Mock 데이터 제거
- `mock-data.ts` 제거
- 모든 데이터 Supabase에서 가져오기

### Phase 4: 실시간 기능
- Supabase Realtime 구독
- 알림/댓글/도움됨 실시간 반영
- 알림 트리거 (DB trigger)

### Phase 5: 추가 기능
- 이미지 업로드 (Supabase Storage)
- 슬롯 알림 (푸시)
- Admin 도구
- 사용자 행사 등록 (PRD 6.20)

---

## 미구현 기능 목록

> TODO.md 기반

### P0 필수 기능
- [x] 양도글 티켓 사진 필수화 (PRD 6.19)
- [x] 비로그인 시 로그인 유도 모달
- [ ] **권한 관리 (PRD 6.0)** — 부분 완료
  - [x] 비로그인 로그인 유도 (찜/다녀옴/글쓰기/댓글/도움됨)
  - [ ] USER 역할 권한 (글/댓글, 찜/다녀옴, 알림 설정)
  - [ ] ADMIN 역할 권한 (허브 편집, override, 신고 처리)

### P1 고도화 필요
- [ ] 카카오 OAuth (KOE205 에러 - 사업자 인증 필요)
- [ ] 슬롯 리뷰/슬롯 영상 연결 ("이 행사에서의 무대" 귀속)
- [ ] 프라이버시 설정 실제 필터링 적용 (canViewContent)
- [ ] Quiet Hours (22:00–08:00) 알림 처리
- [ ] 알림 중복 묶음 (dedupe_key, 30분 내 1회)
- [ ] 함께 보기 (크루원 타임테이블 오버레이)
- [ ] FOMO 루프 (친구 다녀온 행사 하이라이트)
- [ ] 푸시 알림 연동 (slot_start_reminder)
- [ ] Supabase 저장 + 실시간 동기화 (나만의 타임테이블)

### P2 확장 기능
- [ ] 콜가이드 커뮤니티 협업 (버전 히스토리, 수정 제안, 롤백)
- [ ] 티켓북 AI 마스킹 (개인정보 자동 가림)
- [ ] **티켓북 공유 기능**
  - 이미지 공유 (티켓 1장 또는 컬렉션 그리드)
  - 다양한 뷰 템플릿 (가로/세로/그리드/콜라주)
  - 공유용 웹페이지 생성 (1페이지 갤러리, 공유 링크)
  - SNS 공유 (인스타 스토리, 카카오톡, 트위터)
- [ ] 연말 결산 리포트 ("20XX 나의 공연 리포트")
- [ ] 공연로그 사진/메모 첨부
- [ ] 크루 동행 기록
- [ ] 리더보드 윌슨 스코어/최근성 가중치
- [ ] 리더보드 어뷰징 방지

### P2 Admin 도구 (PRD 6.10.1)
- [ ] 행사 생성/수정
- [ ] 상태/기간/타임존 변경
- [ ] Official 공지 관리
- [ ] 모드 override 설정
- [ ] 신고 큐 / 모더레이션
- [ ] 감사로그 (Audit log)

### P2 사용자 콘텐츠 등록 (PRD 6.20)
> 상세 기획: `docs/proposals/user-event-registration.md`
- [ ] 사용자 행사 등록 폼
- [ ] 장소 검색 API 연동 (카카오/네이버)
- [ ] 타임테이블 편집 모드
- [ ] 셋리스트 에디터
- [ ] 수정 제안 시스템

### 데이터 수집 파이프라인 (Future)
> 상세 설계: `docs/tech/ingestion_crawling.md`
- [ ] Fetcher: URL 요청/Headless 렌더링
- [ ] Extractor: 소스별 파서 (yes24, interpark, instagram)
- [ ] Normalizer: 날짜/장소 표준화
- [ ] Change Detector: diff 계산

---

## 개발 팁

### Mock vs Supabase 모드 전환
```typescript
// UUID 형식이면 Supabase 데이터, 아니면 Mock 데이터
const isValidUUID = (id: string) =>
  /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(id);

// 사용 예시
if (useSupabase && isValidUUID(callGuideId)) {
  // Supabase 쿼리 실행
} else {
  // localStorage 사용
}
```

### 로그인 상태 확인 패턴
```typescript
// DevContext (개발용) + AuthContext (실제 인증) 둘 다 확인
const { isLoggedIn: devIsLoggedIn } = useDevContext();
const { user } = useAuth();
const isLoggedIn = !!user || devIsLoggedIn;
```

### Context Provider 순서
`layout.tsx`의 Provider 중첩 순서를 유지해야 합니다.
의존성이 있는 Context는 상위에 위치해야 합니다.

### 개발 워크플로우
```
1단계: Mock 데이터로 UI/UX 구현
  → 빠른 프로토타이핑, 서버 없이 동작

2단계: Context 시스템 구축
  → React Context + localStorage

3단계: Supabase 연동
  → isValidUUID()로 Mock/Supabase 구분

4단계: 전체 마이그레이션
  → Mock 제거, 프로덕션 준비
```

---

## 참고 문서

| 문서 | 경로 | 설명 |
|------|------|------|
| PRD v0.5 | `docs/PRD_fesmate_v0.5_UPDATED.md` | 제품 요구사항 |
| UX/IA v0.5 | `docs/UX_IA_fesmate_v0.5_UPDATED.md` | 정보구조/화면 구성 |
| TODO | `docs/TODO.md` | 개발 태스크 목록 |
| DB 스키마 | `docs/tech/database-schema.md` | Supabase DB 설계 |
| 마이그레이션 계획 | `docs/tech/supabase-migration-plan.md` | Mock → Supabase 전환 |
| 콜가이드 설계 | `docs/tech/call_guide.md` | 콜가이드 시스템 |
| 이미지 업로드 | `docs/tech/image_upload.md` | 이미지 업로드 시스템 |
| 지도 딥링크 | `docs/tech/maps_deeplink.md` | 지도 앱 연동 |
| 사용자 행사 등록 | `docs/proposals/user-event-registration.md` | 사용자 콘텐츠 등록 기획 |

---

## 변경 이력

| 날짜 | 커밋 | 내용 |
|------|------|------|
| 2025-11-29 | `9c045b7` | 프로젝트 시작 |
| 2025-12-17 | `782c2ff` | Phase 1-6 UI 구현 |
| 2025-12-18 | `b159891` | 인증/알림/안전 시스템 |
| 2025-12-20 | `0acdb25` | Context 시스템 구축 |
| 2025-12-21 | `780e34c` | FieldNote/콜가이드 추가 |
| 2025-12-23 | `8d10948` | 티켓북 시스템 구현 |
| 2025-12-24 | `11c8d16` | 티켓 편집 버그 수정 |
| 2025-12-31 | `c6abdb9` | Supabase 연동 시작 |
| 2025-12-31 | - | **13개 Context Supabase 연동 완료 확인** |
| 2025-12-31 | - | **DB 마이그레이션 완료 확인 (MCP 검증)** |
| 2025-12-31 | - | **Phase 2 완료: 19개 Context 전체 Supabase 연동** |
| 2025-12-31 | - | **Supabase Storage 이미지 업로드 구현** |

---

## Supabase Storage 이미지 업로드

### 추가된 버킷
| 버킷 | 용도 | 최대 크기 |
|------|------|----------|
| `post-images` | 게시글 이미지 | 5MB |
| `ticket-images` | 티켓북 이미지 | 5MB |
| `avatars` | 프로필 이미지 | 2MB |

### 추가된 파일
- `src/lib/storage/supabase-image-storage.ts` - Supabase Storage 어댑터
- `supabase/migrations/create_storage_buckets.sql` - 버킷 생성 및 RLS 정책

### 사용법
```typescript
import { getImageStorage } from "@/lib/storage";

// 환경변수 기반 자동 선택
const storage = getImageStorage();

// Supabase 강제 사용
const storage = getImageStorage("supabase", "post-images");

const result = await storage.upload(file);
```

---

## 추가 마이그레이션 (Phase 2)

이번 작업에서 추가된 테이블 및 쿼리 함수:

### 새로 추가된 쿼리 파일
- `src/lib/supabase/queries/companions.ts` - 동행 제안 쿼리
- `src/lib/supabase/queries/tickets.ts` - 티켓북 쿼리
- `src/lib/supabase/queries/badges.ts` - 배지 쿼리
- `src/lib/supabase/queries/leaderboard.ts` - 리더보드 집계 쿼리

### 추가된 테이블
- `companion_requests` - 1:1 동행 제안 (마이그레이션 적용 필요)
- `tickets` - 티켓북 (마이그레이션 적용 필요)
- `user_badges` - 이미 존재 (00002_user_tables.sql)

### 연동 패턴 (공통)
1. **Dual Authentication**: `isRealUser` → Supabase, `!isRealUser` → localStorage
2. **Optimistic Updates**: UI 먼저 업데이트 후 Supabase 호출, 실패 시 롤백
3. **Transform Functions**: DB 스네이크_케이스 → Context 카멜케이스 변환
4. **상태 노출**: `isLoading`, `isFromSupabase`로 데이터 출처 확인 가능

---

> 이 문서는 개발 진행에 따라 업데이트됩니다.
> 마지막 업데이트: 2025-12-31 (Supabase Storage 이미지 업로드 구현)
